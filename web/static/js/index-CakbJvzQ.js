var le=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var z=(s,n,o)=>n in s?le(s,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[n]=o,E=(s,n)=>{for(var o in n||(n={}))oe.call(n,o)&&z(s,o,n[o]);if(h)for(var o of h(n))re.call(n,o)&&z(s,o,n[o]);return s},N=(s,n)=>te(s,ae(n));var D=(s,n,o)=>new Promise((k,y)=>{var d=v=>{try{r(o.next(v))}catch(M){y(M)}},x=v=>{try{r(o.throw(v))}catch(M){y(M)}},r=v=>v.done?k(v.value):Promise.resolve(v.value).then(d,x);r((o=o.apply(s,n)).next())});import{aC as Z,v as se,r as C,h as I,i as ne,c as R,o as b,J as l,V as c,H as F,S as t,G as m,M as J,N as L,T as u,b as S,R as de,ay as q,_ as ie}from"./index-Bvwcnywb.js";import{g as ue}from"./websites-DJqPsjSd.js";import{f as W}from"./time-Rad8uJFk.js";const me=s=>Z.request("post","/export",{data:s}),pe=s=>Z.request("post","/export/batch",{data:s}),B=s=>`/api/export/download/${s}`,_e={class:"data-export"},fe={class:"flex items-center justify-between"},be={class:"mt-1 text-xs text-gray-500"},ve=se({name:"DataExport",__name:"index",setup(s){const n=C("single"),o=C([]),k=C([]),y=C(),d=I({website_id:"",export_type:"full",format:"csv",since_date:"",filters:{}}),x=C(),r=I({website_ids:[],export_type:"full",format:"csv",since_date:"",filters:{}}),v={website_id:[{required:!0,message:"请选择网站",trigger:"change"}],export_type:[{required:!0,message:"请选择导出类型",trigger:"change"}],format:[{required:!0,message:"请选择导出格式",trigger:"change"}]},M={website_ids:[{required:!0,message:"请至少选择一个网站",trigger:"change",validator:(p,e,_)=>{!e||e.length===0?_(new Error("请至少选择一个网站")):_()}}],export_type:[{required:!0,message:"请选择导出类型",trigger:"change"}],format:[{required:!0,message:"请选择导出格式",trigger:"change"}]},U=C(!1),G=()=>D(null,null,function*(){try{const p=yield ue({status:"active"});p.success&&(o.value=p.data)}catch(p){console.error("加载网站列表失败",p)}}),A=()=>D(null,null,function*(){y.value&&(yield y.value.validate(p=>D(null,null,function*(){var e;if(p){U.value=!0;try{const _=yield me(d);if(_.success){q.success("导出成功"),k.value.unshift(N(E({},_.data),{export_time:W(new Date().toISOString()),website_name:((e=o.value.find(f=>f.id===d.website_id))==null?void 0:e.name)||""}));const w=B(_.data.file_name);window.open(w,"_blank")}}catch(_){q.error(_.message||"导出失败")}finally{U.value=!1}}})))}),K=()=>D(null,null,function*(){x.value&&(yield x.value.validate(p=>D(null,null,function*(){if(p){U.value=!0;try{const e=yield pe(r);if(e.success){q.success(`批量导出成功，共导出 ${e.data.website_count} 个网站的数据`);const _=r.website_ids.map(f=>{var V;return((V=o.value.find(i=>i.id===f))==null?void 0:V.name)||""}).filter(f=>f).join(", ");k.value.unshift(N(E({},e.data),{export_time:W(new Date().toISOString()),website_name:`批量导出 (${e.data.website_count}个网站)`}));const w=B(e.data.file_name);window.open(w,"_blank")}}catch(e){q.error(e.message||"批量导出失败")}finally{U.value=!1}}})))}),P=p=>{const e=B(p);window.open(e,"_blank")},Q=()=>{y.value&&y.value.resetFields()},X=()=>{x.value&&x.value.resetFields()};return ne(()=>{G()}),(p,e)=>{const _=m("el-radio-button"),w=m("el-radio-group"),f=m("el-option"),V=m("el-select"),i=m("el-form-item"),g=m("el-radio"),T=m("el-date-picker"),j=m("el-input"),H=m("el-button"),O=m("el-form"),$=m("el-card"),Y=m("el-table-column"),ee=m("el-table");return b(),R("div",_e,[l($,null,{header:t(()=>[S("div",fe,[e[15]||(e[15]=S("span",{class:"text-base font-semibold"},"数据导出",-1)),l(w,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),size:"small"},{default:t(()=>[l(_,{label:"single"},{default:t(()=>e[13]||(e[13]=[u("单个导出",-1)])),_:1,__:[13]}),l(_,{label:"batch"},{default:t(()=>e[14]||(e[14]=[u("批量导出",-1)])),_:1,__:[14]})]),_:1},8,["modelValue"])])]),default:t(()=>[n.value==="single"?(b(),c(O,{key:0,ref_key:"formRef",ref:y,model:d,rules:v,"label-width":"120px",style:{"max-width":"600px"}},{default:t(()=>[l(i,{label:"选择网站",prop:"website_id"},{default:t(()=>[l(V,{modelValue:d.website_id,"onUpdate:modelValue":e[1]||(e[1]=a=>d.website_id=a),placeholder:"请选择网站",style:{width:"100%"}},{default:t(()=>[(b(!0),R(J,null,L(o.value,a=>(b(),c(f,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"导出类型",prop:"export_type"},{default:t(()=>[l(w,{modelValue:d.export_type,"onUpdate:modelValue":e[2]||(e[2]=a=>d.export_type=a)},{default:t(()=>[l(g,{label:"full"},{default:t(()=>e[16]||(e[16]=[u("全量导出（所有历史链接）",-1)])),_:1,__:[16]}),l(g,{label:"incremental"},{default:t(()=>e[17]||(e[17]=[u("增量导出（指定日期后的新链接）",-1)])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1}),d.export_type==="incremental"?(b(),c(i,{key:0,label:"起始日期",prop:"since_date"},{default:t(()=>[l(T,{modelValue:d.since_date,"onUpdate:modelValue":e[3]||(e[3]=a=>d.since_date=a),type:"datetime",placeholder:"选择起始日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss[Z]",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):F("",!0),l(i,{label:"导出格式",prop:"format"},{default:t(()=>[l(w,{modelValue:d.format,"onUpdate:modelValue":e[4]||(e[4]=a=>d.format=a)},{default:t(()=>[l(g,{label:"csv"},{default:t(()=>e[18]||(e[18]=[u("CSV 格式",-1)])),_:1,__:[18]}),l(g,{label:"json"},{default:t(()=>e[19]||(e[19]=[u("JSON 格式",-1)])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"链接类型"},{default:t(()=>[l(V,{modelValue:d.filters.link_type,"onUpdate:modelValue":e[5]||(e[5]=a=>d.filters.link_type=a),placeholder:"全部",clearable:"",style:{width:"100%"}},{default:t(()=>[l(f,{label:"重要链接",value:"valid"}),l(f,{label:"非重要链接",value:"invalid"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"域名过滤"},{default:t(()=>[l(j,{modelValue:d.filters.domain,"onUpdate:modelValue":e[6]||(e[6]=a=>d.filters.domain=a),placeholder:"输入域名进行过滤（可选）",clearable:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(H,{type:"primary",loading:U.value,onClick:A},{default:t(()=>e[20]||(e[20]=[u(" 开始导出 ",-1)])),_:1,__:[20]},8,["loading"]),l(H,{onClick:Q},{default:t(()=>e[21]||(e[21]=[u("重置",-1)])),_:1,__:[21]})]),_:1})]),_:1},8,["model"])):(b(),c(O,{key:1,ref_key:"batchFormRef",ref:x,model:r,rules:M,"label-width":"120px",style:{"max-width":"600px"}},{default:t(()=>[l(i,{label:"选择网站",prop:"website_ids"},{default:t(()=>[l(V,{modelValue:r.website_ids,"onUpdate:modelValue":e[7]||(e[7]=a=>r.website_ids=a),placeholder:"请选择网站（可多选）",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"}},{default:t(()=>[(b(!0),R(J,null,L(o.value,a=>(b(),c(f,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),S("div",be," 已选择 "+de(r.website_ids.length)+" 个网站 ",1)]),_:1}),l(i,{label:"导出类型",prop:"export_type"},{default:t(()=>[l(w,{modelValue:r.export_type,"onUpdate:modelValue":e[8]||(e[8]=a=>r.export_type=a)},{default:t(()=>[l(g,{label:"full"},{default:t(()=>e[22]||(e[22]=[u("全量导出（所有历史链接）",-1)])),_:1,__:[22]}),l(g,{label:"incremental"},{default:t(()=>e[23]||(e[23]=[u("增量导出（指定日期后的新链接）",-1)])),_:1,__:[23]})]),_:1},8,["modelValue"])]),_:1}),r.export_type==="incremental"?(b(),c(i,{key:0,label:"起始日期",prop:"since_date"},{default:t(()=>[l(T,{modelValue:r.since_date,"onUpdate:modelValue":e[9]||(e[9]=a=>r.since_date=a),type:"datetime",placeholder:"选择起始日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss[Z]",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):F("",!0),l(i,{label:"导出格式",prop:"format"},{default:t(()=>[l(w,{modelValue:r.format,"onUpdate:modelValue":e[10]||(e[10]=a=>r.format=a)},{default:t(()=>[l(g,{label:"csv"},{default:t(()=>e[24]||(e[24]=[u("CSV 格式",-1)])),_:1,__:[24]}),l(g,{label:"json"},{default:t(()=>e[25]||(e[25]=[u("JSON 格式",-1)])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"链接类型"},{default:t(()=>[l(V,{modelValue:r.filters.link_type,"onUpdate:modelValue":e[11]||(e[11]=a=>r.filters.link_type=a),placeholder:"全部",clearable:"",style:{width:"100%"}},{default:t(()=>[l(f,{label:"重要链接",value:"valid"}),l(f,{label:"非重要链接",value:"invalid"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"域名过滤"},{default:t(()=>[l(j,{modelValue:r.filters.domain,"onUpdate:modelValue":e[12]||(e[12]=a=>r.filters.domain=a),placeholder:"输入域名进行过滤（可选）",clearable:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(H,{type:"primary",loading:U.value,onClick:K},{default:t(()=>e[26]||(e[26]=[u(" 批量导出 ",-1)])),_:1,__:[26]},8,["loading"]),l(H,{onClick:X},{default:t(()=>e[27]||(e[27]=[u("重置",-1)])),_:1,__:[27]})]),_:1})]),_:1},8,["model"]))]),_:1}),k.value.length>0?(b(),c($,{key:0,class:"mt-4"},{header:t(()=>e[28]||(e[28]=[S("span",{class:"text-base font-semibold"},"导出历史",-1)])),default:t(()=>[l(ee,{data:k.value,stripe:""},{default:t(()=>[l(Y,{prop:"website_name",label:"网站",width:"150"}),l(Y,{prop:"file_name",label:"文件名","min-width":"300","show-overflow-tooltip":""}),l(Y,{prop:"total_records",label:"记录数",width:"100"}),l(Y,{prop:"file_size",label:"文件大小",width:"120"}),l(Y,{prop:"export_time",label:"导出时间",width:"180"}),l(Y,{label:"操作",width:"120",fixed:"right"},{default:t(({row:a})=>[l(H,{type:"primary",size:"small",onClick:we=>P(a.file_name)},{default:t(()=>e[29]||(e[29]=[u(" 下载 ",-1)])),_:2,__:[29]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):F("",!0)])}}}),ce=ie(ve,[["__scopeId","data-v-d3619e5c"]]);export{ce as default};
