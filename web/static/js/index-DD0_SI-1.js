var V=(h,y,o)=>new Promise((m,l)=>{var w=u=>{try{c(o.next(u))}catch(p){l(p)}},b=u=>{try{c(o.throw(u))}catch(p){l(p)}},c=u=>u.done?m(u.value):Promise.resolve(u.value).then(w,b);c((o=o.apply(h,y)).next())});import{g as R}from"./statistics-CC4MdyNV.js";import{g as T}from"./websites-DJqPsjSd.js";import{v as W,r as C,h as $,i as j,c as S,o as v,J as t,I as q,V as F,H as G,S as a,b as n,G as r,M as H,N as J,T as f,aa as Q,R as M,ay as B,_ as K}from"./index-Bvwcnywb.js";const O={class:"statistics"},X={class:"flex flex-wrap items-center gap-4"},Z={class:"flex items-center gap-2"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2"},ae={class:"flex items-center justify-between"},le={class:"text-base font-semibold"},se={class:"mb-6"},oe={class:"mb-6"},ne=W({name:"Statistics",__name:"index",setup(h){const y=C([]),o=$({website_id:"",date_from:"",date_to:""}),m=C(!1),l=C(null),w=[{text:"最近7天",value:()=>{const s=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,s]}},{text:"最近30天",value:()=>{const s=new Date,e=new Date;return e.setDate(e.getDate()-30),[e,s]}},{text:"最近3个月",value:()=>{const s=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,s]}}],b=()=>V(null,null,function*(){try{const s=yield T({status:"active"});s.success&&(y.value=s.data,s.data.length>0&&(o.website_id=s.data[0].id,c()))}catch(s){console.error("加载网站列表失败",s)}}),c=()=>V(null,null,function*(){if(!o.website_id){B.warning("请选择网站");return}m.value=!0;try{const s=yield R(o);s.success&&(l.value=s.data)}catch(s){B.error("加载统计数据失败")}finally{m.value=!1}}),u=()=>{c()},p=()=>{o.date_from="",o.date_to="",c()},x=s=>`${(s*100).toFixed(2)}%`,E=s=>`${s.toFixed(2)}%`;return j(()=>{b()}),(s,e)=>{const P=r("el-option"),U=r("el-select"),z=r("el-date-picker"),A=r("el-button"),g=r("el-card"),k=r("el-text"),D=r("el-divider"),i=r("el-statistic"),d=r("el-col"),Y=r("el-row"),N=r("el-progress"),I=r("el-empty"),L=Q("loading");return v(),S("div",O,[t(g,{class:"mb-4"},{default:a(()=>[n("div",X,[n("div",Z,[e[3]||(e[3]=n("span",{class:"text-sm whitespace-nowrap"},"网站",-1)),t(U,{modelValue:o.website_id,"onUpdate:modelValue":e[0]||(e[0]=_=>o.website_id=_),placeholder:"请选择网站",style:{width:"200px"}},{default:a(()=>[(v(!0),S(H,null,J(y.value,_=>(v(),F(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",ee,[e[4]||(e[4]=n("span",{class:"text-sm whitespace-nowrap"},"日期范围",-1)),t(z,{modelValue:o.date_from,"onUpdate:modelValue":e[1]||(e[1]=_=>o.date_from=_),type:"date",placeholder:"开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",shortcuts:w,style:{width:"150px"}},null,8,["modelValue"]),e[5]||(e[5]=n("span",{class:"text-sm text-gray-500"},"至",-1)),t(z,{modelValue:o.date_to,"onUpdate:modelValue":e[2]||(e[2]=_=>o.date_to=_),type:"date",placeholder:"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",shortcuts:w,style:{width:"150px"}},null,8,["modelValue"])]),n("div",te,[t(A,{type:"primary",onClick:u},{default:a(()=>e[6]||(e[6]=[f("查询",-1)])),_:1,__:[6]}),t(A,{onClick:p},{default:a(()=>e[7]||(e[7]=[f("重置",-1)])),_:1,__:[7]})])])]),_:1}),l.value?q((v(),F(g,{key:0},{header:a(()=>[n("div",ae,[n("span",le,"统计概览 - "+M(l.value.website.name),1),t(k,{type:"info",size:"small"},{default:a(()=>[f(" 统计周期: "+M(l.value.period.from)+" ~ "+M(l.value.period.to),1)]),_:1})])]),default:a(()=>[n("div",se,[t(D,{"content-position":"left"},{default:a(()=>e[8]||(e[8]=[n("span",{class:"text-base font-semibold"},"任务统计",-1)])),_:1,__:[8]}),t(Y,{gutter:20},{default:a(()=>[t(d,{span:6},{default:a(()=>[t(i,{title:"总任务数",value:l.value.summary.total_tasks,"value-style":"color: #409EFF"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"已完成任务",value:l.value.summary.completed_tasks,"value-style":"color: #67C23A"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"失败任务",value:l.value.summary.failed_tasks,"value-style":"color: #F56C6C"},null,8,["value"])]),_:1}),t(d,{span:6},{default:a(()=>[t(i,{title:"任务成功率",value:l.value.summary.total_tasks>0?x(l.value.summary.completed_tasks/l.value.summary.total_tasks):"0%","value-style":"color: #67C23A"},null,8,["value"])]),_:1})]),_:1})]),n("div",oe,[t(D,{"content-position":"left"},{default:a(()=>e[9]||(e[9]=[n("span",{class:"text-base font-semibold"},"链接统计",-1)])),_:1,__:[9]}),t(Y,{gutter:20},{default:a(()=>[t(d,{span:8},{default:a(()=>[t(i,{title:"总爬取链接数",value:l.value.summary.total_links_crawled,"value-style":"color: #409EFF"},null,8,["value"])]),_:1}),t(d,{span:8},{default:a(()=>[t(i,{title:"新增链接数",value:l.value.summary.new_links_found,"value-style":"color: #E6A23C"},null,8,["value"])]),_:1}),t(d,{span:8},{default:a(()=>[t(i,{title:"平均新增率",value:l.value.summary.total_links_crawled>0?x(l.value.summary.new_links_found/l.value.summary.total_links_crawled):"0%","value-style":"color: #E6A23C"},null,8,["value"])]),_:1})]),_:1})]),n("div",null,[t(D,{"content-position":"left"},{default:a(()=>e[10]||(e[10]=[n("span",{class:"text-base font-semibold"},"质量统计",-1)])),_:1,__:[10]}),t(Y,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(g,{shadow:"never",class:"text-center"},{default:a(()=>[t(i,{title:"平均有效率",value:x(l.value.summary.avg_valid_rate),"value-style":"color: #67C23A; font-size: 32px"},null,8,["value"]),t(N,{percentage:l.value.summary.avg_valid_rate*100,"stroke-width":20,format:E,class:"mt-4"},null,8,["percentage"]),t(k,{type:"info",size:"small",class:"mt-2"},{default:a(()=>e[11]||(e[11]=[f(" 重要链接占总连接的比例 ",-1)])),_:1,__:[11]})]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(g,{shadow:"never",class:"text-center"},{default:a(()=>[t(i,{title:"平均精准率",value:x(l.value.summary.avg_precision_rate),"value-style":"color: #409EFF; font-size: 32px"},null,8,["value"]),t(N,{percentage:l.value.summary.avg_precision_rate*100,"stroke-width":20,format:E,color:"#409EFF",class:"mt-4"},null,8,["percentage"]),t(k,{type:"info",size:"small",class:"mt-2"},{default:a(()=>e[12]||(e[12]=[f(" 重要链接识别准确率 ",-1)])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])]),_:1})),[[L,m.value]]):m.value?G("",!0):(v(),F(I,{key:1,description:"请选择网站查看统计数据"}))])}}}),_e=K(ne,[["__scopeId","data-v-0e947ac0"]]);export{_e as default};
